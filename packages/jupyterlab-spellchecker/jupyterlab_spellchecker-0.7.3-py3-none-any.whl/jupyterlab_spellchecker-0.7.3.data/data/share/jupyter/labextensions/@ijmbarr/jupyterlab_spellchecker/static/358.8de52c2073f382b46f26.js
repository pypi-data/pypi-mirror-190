"use strict";(self.webpackChunk_ijmbarr_jupyterlab_spellchecker=self.webpackChunk_ijmbarr_jupyterlab_spellchecker||[]).push([[358],{358:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x,spellcheckIcon:()=>f});var s=n(650),i=n(767),r=n(591),o=n(510),a=n(431),c=n(598),l=n(169),d=n(346),h=n(442),u=n(886),g=n(258),p=n(379),m=n.n(p),_=n(760);m()(_.Z,{insert:"head",singleton:!1}),_.Z.locals;const f=new r.LabIcon({name:"spellcheck:spellcheck",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M12.45 16h2.09L9.43 3H7.57L2.46 16h2.09l1.12-3h5.64l1.14 3zm-6.02-5L8.5 5.48L10.57 11H6.43zm15.16.59l-8.09 8.09L9.83 16l-1.41 1.41l5.09 5.09L23 13l-1.41-1.41z"/>\n  </g>\n</svg>\n'}),k=n(397);class b{constructor(e){const t=e.load(w.id).then((e=>{this.updateSettings(e),e.changed.connect((()=>{this.updateSettings(e)}))}));this.ready=Promise.all([this.fetchServerDictionariesList(),t]).then((()=>{console.debug("LanguageManager is ready")}))}updateSettings(e){e&&(this.onlineDictionaries=e.get("onlineDictionaries").composite.map((e=>Object.assign(Object.assign({},e),{isOnline:!0}))))}fetchServerDictionariesList(){return async function(e="",t={}){const n=g.ServerConnection.makeSettings(),s=u.URLExt.join(n.baseUrl,"spellchecker",e);let i;try{i=await g.ServerConnection.makeRequest(s,t,n)}catch(e){throw new g.ServerConnection.NetworkError(e)}const r=await i.json();if(!i.ok)throw new g.ServerConnection.ResponseError(i,r.message);return r}("language_manager").then((e=>{console.debug("Dictionaries fetched from server"),this.serverDictionaries=e.dictionaries.map((e=>Object.assign(Object.assign({},e),{isOnline:!1})))}))}get dictionaries(){return[...this.serverDictionaries,...this.onlineDictionaries]}getChoices(e){return(e?[e,...this.dictionaries.filter((t=>t.id!==e.id))]:this.dictionaries).sort(((e,t)=>e.name.localeCompare(t.name)))}getLanguageByIdentifier(e){const t=this.dictionaries.find((t=>t.id===e));if(t)return t;const n=this.dictionaries.find((t=>t.id.toLowerCase()===e.replace("-","_").toLowerCase()));return n?(console.warn(`Language identifier ${e} has a non-exact match, please update it to ${n.id}`),n):void 0}}class y extends o.ReactWidget{constructor(e){super(),this.language_source=e}render(){return(0,l.TextItem)({source:this.language_source()})}}class v{constructor(e,t,n,s,i,r,o,a){this.app=e,this.tracker=t,this.editor_tracker=n,this.setting_registry=s,this.code_mirror=i,this.palette=o,this.status_bar=a,this.check_spelling=!0,this.rx_word_char=/[^-[\]{}():/!;&@$£%§<>"*+=?.,~\\^|_`#±\s\t]/,this.rx_non_word_char=/[-[\]{}():/!;&@$£%§<>"*+=?.,~\\^|_`#±\s\t]/,this.ignored_tokens=new Set,this.define_mode=e=>{if(0===e.indexOf("spellcheck_"))return e;const t="spellcheck_"+e;return this.code_mirror.CodeMirror.defineMode(t,(n=>{const s={name:t,token:(e,t)=>{if(e.eatWhile(this.rx_word_char)){const t=e.current().replace(/(^')|('$)/g,"");if(""!==t&&!t.match(/^\d+$/)&&void 0!==this.dictionary&&!this.dictionary.check(t)&&!this.ignored_tokens.has(t))return"spell-error"}return e.eatWhile(this.rx_non_word_char),null}};return this.code_mirror.CodeMirror.overlayMode(this.code_mirror.CodeMirror.getMode(n,e),s,!0)})),t},this.language_manager=new b(s),this._trans=r.load("jupyterlab-spellchecker"),this.status_msg=this._trans.__("Dictionary not loaded"),this.TEXT_SUGGESTIONS_AVAILABLE=this._trans.__("Adjust spelling to"),this.TEXT_NO_SUGGESTIONS=this._trans.__("No spellcheck suggestions"),this.PALETTE_CATEGORY=this._trans.__("Spell Checker"),this.setup_settings(),this.setup_button(),this.setup_suggestions(),this.setup_language_picker(),this.setup_ignore_action(),this.tracker.activeCellChanged.connect((()=>{this.tracker.activeCell&&this.setup_cell_editor(this.tracker.activeCell)})),this.editor_tracker.widgetAdded.connect(((e,t)=>this.setup_file_editor(t.content,!0))),this.editor_tracker.currentChanged.connect(((e,t)=>{null!==t&&this.setup_file_editor(t.content,!1)}))}setup_settings(){Promise.all([this.setting_registry.load(w.id),this.app.restored,this.language_manager.ready]).then((([e])=>{this.update_settings(e),e.changed.connect((()=>{this.update_settings(e)}))})).catch((e=>{console.error(e.message)}))}_set_theme(e){document.body.setAttribute("data-jp-spellchecker-theme",e)}update_settings(e){this.settings=e;const t=e.get("ignore").composite;this.ignored_tokens=new Set(t),this.accepted_types=e.get("mimeTypes").composite;const n=e.get("theme").composite;this._set_theme(n);const s=e.get("language").composite,i=this.language_manager.getLanguageByIdentifier(s);void 0===i?console.warn("The language "+s+" is not supported!"):(this.language=i,this.load_dictionary().catch(console.warn)),this.refresh_state()}setup_file_editor(e,t=!1){if(this.accepted_types&&-1!==this.accepted_types.indexOf(e.model.mimeType)){const t=this.extract_editor(e);this.setup_overlay(t)}t&&e.model.mimeTypeChanged.connect(((t,n)=>{setTimeout((()=>this.setup_file_editor(e)),0)}))}setup_cell_editor(e){if(null!==e&&"markdown"===e.model.type){const t=this.extract_editor(e);this.setup_overlay(t)}}extract_editor(e){return e.editor.editor}setup_overlay(e,t=!0){const n=e.getOption("mode");if("null"!==n)if(this.check_spelling)e.setOption("mode",this.define_mode(n));else{const t=n.match(/^spellcheck_/)?n.substr(11):n;e.setOption("mode",t)}else t&&setTimeout((()=>this.setup_overlay(e,!1)),0)}toggle_spellcheck(){this.check_spelling=!this.check_spelling,console.log("Spell checking is currently: ",this.check_spelling)}setup_button(){this.app.commands.addCommand("spellchecker:toggle-check-spelling",{label:this._trans.__("Toggle spellchecker"),execute:()=>{this.toggle_spellcheck()}}),this.palette&&this.palette.addItem({command:"spellchecker:toggle-check-spelling",category:this.PALETTE_CATEGORY})}get_contextmenu_context(){const e=this.app._contextMenuEvent,t=e.target.closest(".CodeMirror");if(null===t)return null;const n=t.CodeMirror,s=n.coordsChar({left:e.clientX,top:e.clientY});return{editor:n,position:s}}get_current_word(e){const{editor:t,position:n}=e,s=t.getDoc().getLine(n.line);let i=n.ch;for(;i>0&&s[i].match(this.rx_word_char);)i--;let r=n.ch;for(;r<s.length&&s[r].match(this.rx_word_char);)r++;return{line:n.line,start:i,end:r,text:s.substring(i,r)}}setup_suggestions(){this.suggestions_menu=new a.Menu({commands:this.app.commands}),this.suggestions_menu.title.label=this.TEXT_SUGGESTIONS_AVAILABLE,this.suggestions_menu.title.icon=f.bindprops({stylesheet:"menuItem"}),this.app.commands.addCommand("spellchecker:update-suggestions",{execute:e=>{},isVisible:e=>(this.prepare_suggestions(),!1)}),this.app.contextMenu.addItem({selector:".cm-spell-error",command:"spellchecker:update-suggestions"}),this.app.contextMenu.addItem({selector:".cm-spell-error",submenu:this.suggestions_menu,type:"submenu"}),this.app.commands.addCommand("spellchecker:apply-suggestion",{execute:e=>{this.apply_suggestion(e.name)},label:e=>e.name})}setup_ignore_action(){this.app.commands.addCommand("spellchecker:ignore",{execute:()=>{this.ignore()},label:this._trans.__("Ignore")}),this.app.contextMenu.addItem({selector:".cm-spell-error",command:"spellchecker:ignore"})}ignore(){const e=this.get_contextmenu_context();if(null===e)console.log("Could not ignore the word as the context was no longer available");else{const t=this.get_current_word(e);this.settings.set("ignore",[t.text.trim(),...this.settings.get("ignore").composite]).catch(console.warn)}}prepare_suggestions(){const e=this.get_contextmenu_context();let t;if(null===e)t=[];else{const n=this.get_current_word(e);t=this.dictionary.suggest(n.text)}if(this.suggestions_menu.clearItems(),t.length){for(const e of t)this.suggestions_menu.addItem({command:"spellchecker:apply-suggestion",args:{name:e}});this.suggestions_menu.title.label=this.TEXT_SUGGESTIONS_AVAILABLE,this.suggestions_menu.title.className="",this.suggestions_menu.setHidden(!1)}else this.suggestions_menu.title.className="lm-mod-disabled",this.suggestions_menu.title.label=this.TEXT_NO_SUGGESTIONS,this.suggestions_menu.setHidden(!0)}apply_suggestion(e){const t=this.get_contextmenu_context();if(null===t)return void console.warn("Applying suggestion failed (probably was already applied earlier)");const n=this.get_current_word(t);t.editor.getDoc().replaceRange(e,{ch:n.start,line:n.line},{ch:n.end,line:n.line})}load_dictionary(){const e=this.language;return e?(this.status_msg=this._trans.__("Loading dictionary…"),this.status_widget.update(),Promise.all([fetch(e.aff).then((e=>e.text())),fetch(e.dic).then((e=>e.text()))]).then((t=>{this.dictionary=new k(e.name,t[0],t[1]),console.debug("Dictionary Loaded ",e.name,e.id),this.status_msg=e.name,this.status_widget.update(),this.refresh_state()}))):new Promise(((e,t)=>t("Cannot load dictionary: no language set")))}refresh_state(){null!==this.tracker.activeCell&&this.setup_cell_editor(this.tracker.activeCell),null!==this.editor_tracker.currentWidget&&this.setup_file_editor(this.editor_tracker.currentWidget.content)}choose_language(){const e=this.language_manager.getChoices(this.language),t=e.map((e=>e.isOnline?this._trans.__("%1 [%2] (online)",e.name,e.id):this._trans.__("%1 [%2]",e.name,e.id)));o.InputDialog.getItem({title:this._trans.__("Choose spellchecker language"),items:t}).then((n=>{if(null!==n.value){const s=t.indexOf(n.value),i=this.language_manager.getLanguageByIdentifier(e[s].id);if(!i)return void console.error("Language could not be matched - please report this as an issue");this.language=i,this.settings.set("language",this.language.id).catch(console.warn)}}))}setup_language_picker(){this.status_widget=new y((()=>this.status_msg)),this.status_widget.node.onclick=()=>{this.choose_language()},this.app.commands.addCommand("spellchecker:choose-language",{execute:e=>this.choose_language(),label:this._trans.__("Choose spellchecker language")}),this.palette&&this.palette.addItem({command:"spellchecker:choose-language",category:this.PALETTE_CATEGORY}),this.status_bar&&this.status_bar.registerStatusItem("spellchecker:choose-language",{align:"right",item:this.status_widget})}}const w={id:"@ijmbarr/jupyterlab_spellchecker:plugin",autoStart:!0,requires:[i.INotebookTracker,s.IEditorTracker,c.ISettingRegistry,d.ICodeMirror],optional:[h.ITranslator,o.ICommandPalette,l.IStatusBar],activate:function(e,t,n,s,i,r,o,a){console.log("Attempting to load spellchecker");const c=new v(e,t,n,s,i,r||h.nullTranslator,o,a);console.log("Spellchecker Loaded ",c)}},x=w},760:(e,t,n)=>{n.d(t,{Z:()=>r});var s=n(645),i=n.n(s)()((function(e){return e[1]}));i.push([e.id,"body[data-jp-spellchecker-theme='background-box'] .CodeMirror .cm-spell-error:not(.cm-url):not(.cm-tag):not(.cm-word) {\n  background: rgba(255, 0, 0, .15);\n}\n\nbody[data-jp-spellchecker-theme='background-box'][data-jp-theme-light='false'] .CodeMirror .cm-spell-error:not(.cm-url):not(.cm-tag):not(.cm-word) {\n  background: rgba(255, 0, 0, .35);\n  text-shadow: 0 0 5px black;\n}\n\nbody[data-jp-spellchecker-theme='wavy-underline'] .CodeMirror .cm-spell-error:not(.cm-url):not(.cm-tag):not(.cm-word) {\n  text-decoration-line: underline;\n  text-decoration-style: wavy;\n  text-decoration-color: red;\n  /* For Chrome */\n  text-decoration-skip-ink: none;\n}\n\nbody[data-jp-spellchecker-theme='wavy-underline'][data-jp-theme-light='false'] .CodeMirror .cm-spell-error:not(.cm-url):not(.cm-tag):not(.cm-word) {\n  /* Use bright red for dark themes */\n  text-decoration-color: #ff5722;\n}\n\nbody[data-jp-spellchecker-theme='dotted-underline'] .CodeMirror .cm-spell-error:not(.cm-url):not(.cm-tag):not(.cm-word) {\n  text-decoration-line: underline;\n  text-decoration-style: dotted;\n  text-decoration-color: red;\n  /* For Chrome */\n  text-decoration-skip-ink: none;\n}\n\nbody[data-jp-spellchecker-theme='dotted-underline'][data-jp-theme-light='false'] .CodeMirror .cm-spell-error:not(.cm-url):not(.cm-tag):not(.cm-word) {\n  /* Use bright red for dark themes */\n    text-decoration-color: #ff5722;\n}\n",""]);const r=i},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,s){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(s)for(var r=0;r<this.length;r++){var o=this[r][0];null!=o&&(i[o]=!0)}for(var a=0;a<e.length;a++){var c=[].concat(e[a]);s&&i[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},379:(e,t,n)=>{var s,i=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),r=[];function o(e){for(var t=-1,n=0;n<r.length;n++)if(r[n].identifier===e){t=n;break}return t}function a(e,t){for(var n={},s=[],i=0;i<e.length;i++){var a=e[i],c=t.base?a[0]+t.base:a[0],l=n[c]||0,d="".concat(c," ").concat(l);n[c]=l+1;var h=o(d),u={css:a[1],media:a[2],sourceMap:a[3]};-1!==h?(r[h].references++,r[h].updater(u)):r.push({identifier:d,updater:m(u,t),references:1}),s.push(d)}return s}function c(e){var t=document.createElement("style"),s=e.attributes||{};if(void 0===s.nonce){var r=n.nc;r&&(s.nonce=r)}if(Object.keys(s).forEach((function(e){t.setAttribute(e,s[e])})),"function"==typeof e.insert)e.insert(t);else{var o=i(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var l,d=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function h(e,t,n,s){var i=n?"":s.media?"@media ".concat(s.media," {").concat(s.css,"}"):s.css;if(e.styleSheet)e.styleSheet.cssText=d(t,i);else{var r=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(r,o[t]):e.appendChild(r)}}function u(e,t,n){var s=n.css,i=n.media,r=n.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}var g=null,p=0;function m(e,t){var n,s,i;if(t.singleton){var r=p++;n=g||(g=c(t)),s=h.bind(null,n,r,!1),i=h.bind(null,n,r,!0)}else n=c(t),s=u.bind(null,n,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return s(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;s(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s));var n=a(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var s=0;s<n.length;s++){var i=o(n[s]);r[i].references--}for(var c=a(e,t),l=0;l<n.length;l++){var d=o(n[l]);0===r[d].references&&(r[d].updater(),r.splice(d,1))}n=c}}}}}]);