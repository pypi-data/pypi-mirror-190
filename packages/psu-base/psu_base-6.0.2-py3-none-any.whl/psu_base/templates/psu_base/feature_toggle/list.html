{% extends 'psu_base/layout/main.html' %}
{% load base_taglib %}

{%block title%}{%app_name%} - Features{%endblock%}
{% block scripts %}{%datatables%}{% endblock %}

{% block pagecontent %}
    <h1>Features for {%app_name%}</h1>
    <table class="table table-condensed table-striped" id="feature_table">
        <thead>
            <tr>
                <th scope="col">Level</th>
                <th scope="col">Feature Code</th>
                <th scope="col">Feature Title</th>
                <th scope="col">Description</th>
                <th scope="col">Status</th>
                <th scope="col">Activation Date<sup>*</sup></th>
                <th scope="col">Termination Date<sup>*</sup></th>
                <th scope="col"><span class="fa fa-trash-o" aria-hidden="true"></span></th>
            </tr>
        </thead>
        <tbody>

        {### GLOBAL OVERRIDES ###}
        {% for ff in global_overrides%}
            <tr class="text-danger">
                <td>
                    <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>
                    Override
                </td>
                <td><span class="code">{{ff.feature_code}}</span></td>
                <td>
                    {%if is_global_admin%}
                        <span class="datatable-hidden">{{ff.feature_title}}</span>
                        <input type="text" id="title-{{ff.id}}" value="{{ff.feature_title}}" onchange="update_feature($(this));" />
                    {%else%}
                        {{ff.feature_title}}
                    {%endif%}
                </td>
                <td>
                    {%if is_global_admin%}
                        <span class="datatable-hidden">{{ff.feature_description|default:''}}</span>
                        <input type="text" id="description-{{ff.id}}" value="{{ff.feature_description|default:''}}" onchange="update_feature($(this));" />
                    {%else%}
                        {{ff.feature_description|default:''}}
                    {%endif%}
                </td>
                <td>
                    {%if is_global_admin%}
                        <span class="datatable-hidden">{{ff.status}}</span>
                        {%select_menu id=ff.id value=ff.status options=status_options onchange="update_feature($(this));" %}
                    {%else%}
                        {{ff.get_status_description}}
                    {%endif%}

                </td>
                <td class="date">
                    {%if is_global_admin%}
                        <input type="text" id="enable_date-{{ff.id}}" value="{{ff.enable_date_display}}" onchange="update_feature($(this));" />
                    {%else%}
                        {{ff.enable_date_display}}
                    {%endif%}
                </td>
                <td class="date">
                    {%if is_global_admin%}
                        <input type="text" id="disable_date-{{ff.id}}" value="{{ff.disable_date_display}}" onchange="update_feature($(this));" />
                    {%else%}
                        {{ff.disable_date_display}}
                    {%endif%}
                </td>

                <td class="date"><span class="fa fa-trash-o" title="Delete this feature" onclick="delete_feature($(this), {{ff.id}});"></span></td>
            </tr>
        {% endfor %}

        {### APPLICATION FEATURES ###}
        {% for ff in app_features%}
            <tr>
                <td>{{app_options|get:ff.app_code}}</td>
                <td><span class="code">{{ff.feature_code}}</span></td>
                <td>
                    <span class="datatable-hidden">{{ff.feature_title}}</span>
                    <input type="text" id="title-{{ff.id}}" value="{{ff.feature_title}}" onchange="update_feature($(this));" />
                </td>
                <td>
                    <span class="datatable-hidden">{{ff.feature_description|default:''}}</span>
                    <input type="text" id="description-{{ff.id}}" value="{{ff.feature_description|default:''}}" onchange="update_feature($(this));" />
                </td>
                <td>
                    <span class="datatable-hidden">{{ff.status}}</span>
                    {%select_menu id=ff.id value=ff.status options=status_options onchange="update_feature($(this));" %}
                </td>
                <td>
                    <input type="text" id="enable_date-{{ff.id}}" value="{{ff.enable_date_display}}" onchange="update_feature($(this));" />
                </td>
                <td>
                    <input type="text" id="disable_date-{{ff.id}}" value="{{ff.disable_date_display}}" onchange="update_feature($(this));" />
                </td>
                <td class="date"><span class="fa fa-trash-o" title="Delete this feature" onclick="delete_feature($(this), {{ff.id}});"></span></td>
            </tr>
        {% endfor %}


        {### GLOBAL DEFAULTS ###}
        {% for ff in global_defaults%}
            <tr class="text-muted">
                <td>
                    <span class="fa fa-globe" title="Global"></span>
                    Default
                </td>
                <td><span class="code">{{ff.feature_code}}</span></td>
                <td>
                    {%if is_global_admin%}
                        <span class="datatable-hidden">{{ff.feature_title}}</span>
                        <input type="text" id="title-{{ff.id}}" value="{{ff.feature_title}}" onchange="update_feature($(this));" />
                    {%else%}
                        {{ff.feature_title}}
                    {%endif%}
                </td>
                <td>
                    {%if is_global_admin%}
                        <span class="datatable-hidden">{{ff.feature_description|default:''}}</span>
                        <input type="text" id="description-{{ff.id}}" value="{{ff.feature_description|default:''}}" onchange="update_feature($(this));" />
                    {%else%}
                        {{ff.feature_description|default:''}}
                    {%endif%}
                </td>
                <td>
                    {%if is_global_admin%}
                        <span class="datatable-hidden">{{ff.status}}</span>
                        {%select_menu id=ff.id value=ff.status options=status_options onchange="update_feature($(this));" %}
                    {%else%}
                        {{ff.get_status_description}}
                    {%endif%}

                </td>
                <td class="date">
                    {%if is_global_admin%}
                        <input type="text" id="enable_date-{{ff.id}}" value="{{ff.enable_date_display}}" onchange="update_feature($(this));" />
                    {%else%}
                        {{ff.enable_date_display}}
                    {%endif%}
                </td>
                <td class="date">
                    {%if is_global_admin%}
                        <input type="text" id="disable_date-{{ff.id}}" value="{{ff.disable_date_display}}" onchange="update_feature($(this));" />
                    {%else%}
                        {{ff.disable_date_display}}
                    {%endif%}
                </td>
                <td class="date"><span class="fa fa-trash-o" title="Delete this feature" onclick="delete_feature($(this), {{ff.id}});"></span></td>
            </tr>
        {% endfor %}
        </tbody>
    </table>



    <br />
    <h2>Add a New Feature Toggle</h2>
    <form action="{% url 'psu:add_feature' %}" method="post" id="feature-form">
        {%csrf_token%}
        <table class="table table-condensed table-striped" id="feature_form">
            <thead>
                <tr>
                    <th scope="col">Level</th>
                    <th scope="col">Feature Code</th>
                    <th scope="col">Feature Title</th>
                    <th scope="col">Description</th>
                    <th scope="col">Status</th>
                    <th scope="col">Activation Date<sup>*</sup></th>
                    <th scope="col">Termination Date<sup>*</sup></th>
                    <th scope="col"><span class="fa fa-trash-o" aria-hidden="true"></span></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <select name="app_code">
                            {%for app_id, app_title in app_options.items%}
                                <option id="{{app_id}}">{{app_id}}</option>
                            {%endfor%}
                            {%if is_global_admin%}
                                <option value="global_default">Global Default</option>
                                <option value="global_override">Global Override</option>
                            {%endif%}
                        </select>
                    </td>
                    <td class="code"><input type="text" name="feature_code" /></td>
                    <td><input type="text" name="feature_title" /></td>
                    <td><input type="text" name="feature_description" /></td>
                    <td>
                        {%select_menu name="status" id="new" value="L" options=status_options %}
                    </td>
                    <td><input type="text" name="enable_date" placeholder="DD-MON-YYYY HH:MM" /></td>
                    <td><input type="text" name="disable_date" placeholder="DD-MON-YYYY HH:MM" /></td>
                    <td>
                        <button type="submit" class="btn btn-success btn-sm">
                            <span class="fa fa-plus" aria-hidden="true"></span>
                            Add
                        </button>
                    </td>
                    <td>&nbsp;</td>
                </tr>
            </tbody>
        </table>
    </form>

    <br />

    <sup>*</sup> If an activation date is provided, the feature will be switched to active on the specified date and time.<br />
    <sup>*</sup> If a termination date is specified, the feature will be set to inactive at the specified date and time.
    <br /><br />
    <p>
        You may specify the date/time in any reasonable format.  If only a date is given, the time will default to 00:00<br />
        Examples:
        <ul>
            <li>{{now.banner_date_time}}</li>
            <li>{{now.timestamp}}</li>
            <li>{{now.date_field}}</li>
        </ul>
    </p>

    <style>
        #feature_table input{
            width: 100%;
        }
        .text-muted input, .text-muted select{
            color: #777;
        }
        .text-danger input, .text-danger select{
            color: red;
        }
        .date{
            font-size: .75em;
            cursor: default;
        }
        span.datatable-hidden{
            display: none;
        }
    </style>

    <script type="text/javascript">
        {%include 'psu_base/feature_toggle/list.js'%}
    </script>

{% endblock %}