"use strict";(self.webpackChunkglobus_jupyterlab=self.webpackChunkglobus_jupyterlab||[]).push([[909],{4236:(e,t,a)=>{a.r(t),a.d(t,{default:()=>C,globus:()=>x});var n=a(5510),s=a(3535),l=a(4886),r=a(6591),o=a(1258);const i=(e="")=>{const t=o.ServerConnection.makeSettings();return l.URLExt.join(t.baseUrl,e)},c=new r.LabIcon({name:"globusIcon",svgstr:'\n      <svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="200.000000pt" height="200.000000pt" viewBox="0 0 200.000000 200.000000" preserveAspectRatio="xMidYMid meet">\n        <g transform="translate(0.000000,200.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">\n          <path d="M480 1697 c-151 -51 -255 -148 -321 -297 -21 -49 -24 -69 -24 -180 0 -114 3 -131 28 -189 15 -36 24 -68 20 -71 -5 -4 -31 -23 -60 -44 -74 -52 -108 -123 -101 -209 12 -147 127 -268 315 -334 72 -26 90 -28 248 -29 94 0 188 -6 210 -12 146 -40 464 -41 659 -2 259 51 411 132 478 256 55 101 46 177 -30 252 -44 44 -46 49 -48 107 -2 106 -72 213 -167 256 -46 20 -167 26 -211 10 -23 -9 -27 -6 -54 43 -56 99 -149 158 -284 181 -32 5 -43 14 -71 58 -62 96 -156 167 -274 206 -88 29 -224 29 -313 -2z m307 -238 c15 -5 40 -22 56 -37 l27 -26 0 32 0 32 85 0 c69 0 85 -3 85 -15 0 -9 -9 -15 -22 -15 -12 0 -30 -7 -40 -17 -17 -15 -18 -37 -18 -272 0 -141 -4 -271 -9 -289 -5 -17 -6 -32 -2 -32 13 0 104 101 130 143 13 21 34 68 46 105 21 61 25 67 56 74 40 9 104 1 140 -18 30 -15 89 -79 89 -97 0 -7 4 -18 9 -26 7 -11 15 -10 42 10 50 36 151 39 199 7 53 -36 80 -83 80 -138 0 -40 4 -49 31 -69 74 -55 88 -132 39 -218 -79 -137 -270 -220 -535 -230 -150 -6 -282 11 -415 53 -73 23 -100 26 -193 24 -164 -3 -282 34 -352 111 -64 71 -54 141 26 181 41 22 83 23 158 4 50 -13 110 -20 151 -17 8 1 -9 12 -38 26 -41 19 -56 33 -68 60 -8 20 -12 40 -9 45 4 6 26 10 50 10 39 0 46 -4 60 -29 21 -41 53 -61 98 -61 47 0 89 21 104 52 7 12 15 58 18 101 7 77 0 93 -25 63 -6 -8 -32 -23 -56 -32 -64 -24 -141 -7 -193 45 -88 88 -96 292 -16 398 47 61 141 89 212 62z"/>\n          <path d="M687 1400 c-41 -32 -62 -102 -62 -205 0 -110 21 -160 79 -189 33 -16 41 -17 74 -5 29 11 43 25 62 64 21 43 25 63 24 145 0 78 -4 104 -22 141 -33 69 -102 90 -155 49z"/>\n        </g>\n      </svg>\n    '});var m=a(6235),u=a(6271),d=a.n(u),p=a(3722);function h(e=""){const t=o.ServerConnection.makeSettings();return l.URLExt.join(t.baseUrl,e)}async function g(e="",t={}){const a=o.ServerConnection.makeSettings(),n=l.URLExt.join(a.baseUrl,"globus-jupyterlab",e);let s;try{console.log("making request to: "+n),s=await o.ServerConnection.makeRequest(n,t,a)}catch(e){throw new o.ServerConnection.NetworkError(e)}if(!s.ok)throw new o.ServerConnection.ResponseError(s);return await s.json()}const f=(0,p.atom)({key:"ConfigAtom",default:{collection_id:"",collection_base_path:"",is_gcp:!1,is_hub:!1,is_manual_copy_code_required:!1,is_logged_in:!1,collection_id_owner:"",last_login:null}}),b=(0,p.atom)({key:"TransferAtom",default:{source_endpoint:"",destination_endpoint:"",transfer_items:[{source_path:"",destination_path:"",recursive:!1}]}}),E=((0,p.selector)({key:"TransferSelector",get:({get:e})=>e(b),set:({get:e,set:t},a)=>{let n=e(b),s=Object.assign(Object.assign({},n),a);t(b,s)}}),e=>{const[t,a]=(0,u.useState)(null),[n,s]=(0,u.useState)(null),l=(0,u.useRef)(null),r=(0,m.useHistory)(),o=(0,u.useRef)(null);return e.hubResponse.login_required&&(0,u.useEffect)((()=>{o.current.disabled=!0}),[]),(0,u.useEffect)((()=>{if("details"in e.hubResponse){const t=l.current,a=e.hubResponse.details.replace(/(?:\r\n|\\r\\n|\r|\n)/g,"<br/>");t.innerHTML=a}}),[e]),t?d().createElement("div",{className:"alert alert-danger alert-dismissible col-8 fade show"},d().createElement("strong",null,"Error ",t.response.status,": ",t.response.statusText,".")," ",t.details&&t.details,d().createElement("button",{type:"button",className:"btn-close","data-bs-dismiss":"alert","aria-label":"Close"})):d().createElement("div",{className:"container mt-3"},d().createElement("div",{className:"row"},d().createElement("div",{className:"col-10"},t&&d().createElement("div",{id:"api-error",className:"alert alert-danger"},d().createElement("strong",null,"Error ",t.response.status,": ",t.response.statusText,".")," ","Please try again."),d().createElement("button",{className:"btn btn-sm btn-outline-secondary mb-3",onClick:()=>r.goBack()},d().createElement("i",{className:"fa-solid fa-angle-left"})," Back to Search"),d().createElement("ol",{className:"list-group"},e.endpoint&&d().createElement("li",{className:"list-group-item p-4"},d().createElement("h5",{className:"mb-1"},d().createElement("i",{className:"fa-solid fa-layer-group"})," ",e.endpoint.display_name),d().createElement("p",{className:"mb-0 mt-2 fw-bold"},"Owner:"),d().createElement("p",{className:"mb-1"},e.endpoint.owner_string),e.endpoint.description&&d().createElement(d().Fragment,null,d().createElement("p",{className:"mb-0 mt-2 fw-bold"},"Description:"),d().createElement("p",{className:"mb-1"},e.endpoint.description))),d().createElement("li",{className:"list-group-item p-4"},d().createElement("div",{className:"ms-2 me-auto"},e.hubResponse.login_required||!e.config.is_logged_in?d().createElement("div",{className:"fw-bold mb-3"},d().createElement("p",{className:"lead"},"Log In to Globus to obtain an Authorization Code for this transfer")):d().createElement("div",{className:"fw-bold mb-3"},d().createElement("p",{className:"lead"},"You must authenticate with the identity that is allowed to access this endpoint or collection")),d().createElement("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>{let t="login_url"in e.hubResponse?e.hubResponse.login_url:h("globus-jupyterlab/login");window.open(t,"Globus Login","height=600,width=800").focus()}},e.hubResponse.login_required||!e.config.is_logged_in?"Log In to Globus":"Continue"))),(e.hubResponse.login_required||!e.config.is_logged_in)&&d().createElement("li",{className:"list-group-item p-4"},d().createElement("div",{className:"ms-2 me-auto"},d().createElement("div",{className:"fw-bold mb-3"},d().createElement("p",{className:"lead"},"Copy and paste the Authorization Code you just received from Globus")),d().createElement("label",{htmlFor:"code-input",className:"form-label"},"Authorization Code"),d().createElement("input",{type:"text",id:"code-input",className:"form-control mb-3",name:"code-input",onChange:e=>{e.target.value&&(o.current.disabled=!1),s(e.target.value)}}),d().createElement("button",{type:"button",className:"btn btn-primary",ref:o,onClick:async e=>{e.preventDefault();try{await g(`oauth_callback_manual?code=${n}`)}catch(e){a(e)}}},"Continue"))),"details"in e.hubResponse&&d().createElement("li",{className:"list-group-item"},d().createElement("div",{className:"ms-2 me-auto my-3"},d().createElement("button",{className:"btn btn-outline-secondary",onClick:e=>{var t;l.current.classList.contains("hide-element")?(l.current.classList.remove("hide-element"),l.current.classList.add("show-element"),t=document.createTextNode("Hide Details")):(l.current.classList.remove("show-element"),l.current.classList.add("hide-element"),t=document.createTextNode("Show Details")),e.target.removeChild(e.target.childNodes[0]),e.target.appendChild(t)}},"Show details"),d().createElement("div",{className:"hide-element mt-3",ref:l})))))))});class y extends n.ReactWidget{constructor(e){super(e),this.state={config:e.config}}render(){return d().createElement(E,{config:"config"in this.state?this.state.config:null,endpoint:null,hubResponse:{}})}}var v=a(6470);const w=e=>{const[t,a]=(0,u.useState)(null),[n,s]=(0,u.useState)({DATA:[],path:null}),[l,r]=(0,u.useState)(null),[o,i]=(0,u.useState)(null),[c,h]=(0,u.useState)(!1),[b,y]=(0,u.useState)([]),[w,N]=(0,u.useState)(null),_=d().useRef([]),[k,S]=(0,u.useState)(null),[x,C]=(0,u.useState)(!1),T=(0,p.useRecoilValue)(f);let j=(0,m.useHistory)(),A=(0,m.useParams)(),R=A.endpointID,I=A.path,D=(()=>{const{search:e}=(0,m.useLocation)();return d().useMemo((()=>new URLSearchParams(e)),[e])})();(0,u.useEffect)((()=>{const e=e=>{e.shiftKey&&C(!1)};return document.addEventListener("keyup",e),()=>{document.removeEventListener("keyup",e)}}),[]),(0,u.useEffect)((()=>{const e=e=>{e.shiftKey&&C(!0)};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[]),(0,u.useEffect)((()=>(L(R,I),()=>{a(null),s({DATA:[],path:null})})),[R,I]);const L=async(e,t=null)=>{h(!0),a(null),s({DATA:[],path:null});let n=await g(`endpoint_detail?endpoint=${e}`);if(!n.activated&&0==n.expires_in){let e=await g("endpoint_autoactivate",{body:JSON.stringify({endpoint_id:n.id}),method:"POST"});console.log(e)}r(n);try{var l=D.get("full-path"),o=`operation_ls?endpoint=${e}`;l&&(o=`${o}&path=${l}`);const t=await g(o);h(!1),s(t)}catch(t){h(!1);let n=await t.response.json();if("login_url"in n){var c=await g("config"),m=new Date(c.last_login).getTime();let t=window.setInterval((async()=>{const a=await g("config");new Date(a.last_login).getTime()!==m&&(j.push("/"),j.replace(`/endpoints/${e}`),clearInterval(t))}),1e3);T.is_hub?(a(null),i(n)):window.open(n.login_url,"Globus Login","height=600,width=800").focus()}else a(Object.assign(Object.assign({},t),{global:!0}))}h(!1)},J=e=>{var t;if(x){if(null!==k){let a=_.current,n=a.indexOf(k),s=a.indexOf(e.target);(t=a.slice(Math.min(n,s),Math.max(n,s)+1)).forEach((e=>{e.checked=n<s}))}}else t=[e.target];(t=[...new Set(t)]).length>1&&y([]),t.forEach(((e,t)=>{if(e.checked)y((t=>[JSON.parse(e.value),...t]));else{const t=JSON.parse(e.value),a=b.map((e=>e.name)).indexOf(t.name);a>-1&&(b.splice(a,1),y(b))}})),S(e.target)};return t&&t.global?d().createElement("div",{className:"alert alert-danger alert-dismissible col-8 fade show"},d().createElement("strong",null,"Error ",t.response.status,": ",t.response.statusText,".")," ",t.details&&t.details,d().createElement("button",{type:"button",className:"btn-close","data-bs-dismiss":"alert","aria-label":"Close"})):c?d().createElement("h5",{className:"mt-3"},"Loading"):o?d().createElement(E,{config:T,endpoint:l,hubResponse:o}):d().createElement(d().Fragment,null,n.DATA.length>0?d().createElement("div",{className:"mt-3"},d().createElement("h5",null,"Browsing Collection ",l?l.display_name:R),d().createElement("div",{className:"btn-group mb-4 mt-2"},d().createElement("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>j.goBack()},d().createElement("i",{className:"fa-solid fa-turn-up"})," Up one folder"),d().createElement("button",{className:"btn btn-sm btn-outline-primary",onClick:e.handleShowSearch},d().createElement("i",{className:"fa-solid fa-magnifying-glass"})," Show search")),w&&d().createElement("div",{className:"alert alert-success alert-dismissible col-8 fade show"},d().createElement("h4",{className:"alert-heading"},"Accepted!"),d().createElement("p",null,w.message),d().createElement("hr",null),d().createElement("p",{className:"mb-0"},d().createElement("a",{className:"alert-link",href:`https://app.globus.org/activity/${w.task_id}`,target:"_blank"},"Check Status of Request"," ",d().createElement("i",{className:"fa-solid fa-arrow-up-right-from-square"}))),d().createElement("button",{type:"button",className:"btn-close","data-bs-dismiss":"alert","aria-label":"Close"})),t&&d().createElement("div",{className:"alert alert-danger alert-dismissible col-8 fade show"},d().createElement("strong",null,"Error ",t.response.status,": ",t.response.statusText,".")," ",t.details&&t.details,d().createElement("button",{type:"button",className:"btn-close","data-bs-dismiss":"alert","aria-label":"Close"})),d().createElement("br",null),d().createElement("div",{id:"endpoint-list",className:"border col-8 rounded py-3"},n.DATA.map(((e,t)=>d().createElement("div",{className:"form-check ms-3",key:t},"dir"==e.type?d().createElement(d().Fragment,null,d().createElement("input",{className:"form-check-input",type:"checkbox",value:JSON.stringify(e),ref:e=>_.current[t]=e,onChange:J,"data-list-item-name":e.name}),d().createElement("label",null,d().createElement(m.Link,{to:`/endpoints/${R}/items/${e.name}?full-path=${n.path}${e.name}`},d().createElement("i",{className:"fa-solid fa-folder-open"})," ",e.name))):d().createElement(d().Fragment,null,d().createElement("input",{className:"form-check-input",type:"checkbox",value:JSON.stringify(e),ref:e=>_.current[t]=e,onChange:J,"data-list-item-name":e.name}),d().createElement("label",null,d().createElement("i",{className:"fa-solid fa-file"})," ",e.name)))))),d().createElement("div",{id:"transfer-direction"},d().createElement("div",{className:"btn-group mt-4"},d().createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:async t=>{t.preventDefault(),a(null),h(!0),N(null);var s=T.collection_id,r=l.id,o=[];if(0===e.selectedJupyterItems.directories.length||e.selectedJupyterItems.directories.length>1)h(!1),a({response:{status:"DirectorySelectionError",statusText:"To transfer to Jupyter Hub, you must select only one directory to transfer to"}});else if(e.selectedJupyterItems.files.length)h(!1),a({response:{status:"DirectorySelectionError",statusText:"To transfer to Jupyter Hub, you must select a directory for a destination"}});else{for(let t of b){let a=v.posix.resolve(n.path,t.name),s=v.posix.resolve(T.collection_base_path,e.selectedJupyterItems.directories[0].path,t.name);o.push({source_path:a,destination_path:s,recursive:"dir"==t.type})}let t={source_endpoint:r,destination_endpoint:s,DATA:o};try{const e=await g("submit_transfer",{body:JSON.stringify(t),method:"POST"});h(!1),N(e)}catch(e){h(!1),a(e)}}}},d().createElement("i",{className:"fa-solid fa-arrow-left"})," Transfer To JupyterLab"),d().createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:async t=>{t.preventDefault(),a(null),h(!1),N(null);var s=l.id,r=T.collection_id,o=[];if(0==b.length)h(!1),a({response:{status:"DirectorySelectionError",statusText:"Please select one remote directory to transfer data to"}});else if(b.length>1)h(!1),a({response:{status:"DirectorySelectionError",statusText:"Please only select one remote directory to transfer data to"}});else if(1==b.length)if("file"==b[0].type)h(!1),a({response:{status:"DirectorySelectionError",statusText:"To transfer to an endpoint, you must select a directory for a destination"}});else{if(e.selectedJupyterItems.directories.length)for(let t of e.selectedJupyterItems.directories){let e=b.length?v.posix.resolve(n.path,b[0].name,t.path):v.posix.resolve(n.path,t.path),a=v.posix.resolve(T.collection_base_path,t.path);o.push({source_path:a,destination_path:e,recursive:!0})}if(e.selectedJupyterItems.files.length)for(let t of e.selectedJupyterItems.files){let e=b.length?v.posix.resolve(n.path,b[0].name,t.path):v.posix.resolve(n.path,t.path),a=v.posix.resolve(T.collection_base_path,t.path);o.push({source_path:a,destination_path:e,recursive:!1})}let t={source_endpoint:r,destination_endpoint:s,DATA:o};try{const e=await g("submit_transfer",{body:JSON.stringify(t),method:"POST"});h(!1),N(e)}catch(e){h(!1),a(e)}}}},d().createElement("i",{className:"fa-solid fa-arrow-right"})," Transfer From JupyterLab")))):d().createElement("div",null,d().createElement("button",{className:"btn btn-sm btn-primary mb-2 mt-3",onClick:()=>j.goBack()},"Back"),d().createElement("p",null,"No files or folders found")))},N=e=>d().createElement("div",{className:"row"},e.endpoints.DATA.length>0&&d().createElement("div",{className:"col-8"},d().createElement("div",{className:"list-group"},e.endpoints.DATA.map((t=>d().createElement(m.Link,{key:t.id,to:`/endpoints/${t.id}`,className:"list-group-item list-group-item-action flex-column align-items-start",onClick:e.handleEndpointClick},d().createElement("h5",{className:"mb-1"},d().createElement("i",{className:"fa-solid fa-layer-group"})," ",t.display_name),d().createElement("p",{className:"mb-0 mt-2 fw-bold"},"Owner:"),d().createElement("p",{className:"mb-1"},t.owner_string),t.description&&d().createElement(d().Fragment,null,d().createElement("p",{className:"mb-0 mt-2 fw-bold"},"Description:"),d().createElement("p",{className:"mb-1"},t.description)))))))),_=e=>{const[t,a]=(0,u.useState)(null),[n,s]=(0,u.useState)({DATA:[]}),[l,r]=(0,u.useState)(""),[o,i]=(0,u.useState)(!1),c=(0,u.useRef)(),p=(0,m.useHistory)(),h=(0,m.useLocation)();(0,u.useEffect)((()=>{"/endpoints"==h.pathname&&(c.current.style.display="block")}),[h]);const f=e=>{c.current.style.display="none"},b=()=>{c.current.style.display="block"};return t?d().createElement("div",{id:"api-row",className:"row"},d().createElement("div",{className:"col-8"},d().createElement("div",{className:"alert alert-danger"},d().createElement("strong",null,"Error ",t.response.status,": ",t.response.statusText,".")," ","Please try again."))):o?d().createElement("h5",null,"Loading"):d().createElement("div",{id:"endpoint-search",className:"mb-4"},d().createElement("div",{ref:c},d().createElement("h5",null,"Search for Globus Collections"),d().createElement("div",{className:"row"},d().createElement("div",{className:"col-8"},d().createElement("input",{id:"endpoint-input",className:"form-control",placeholder:"Start typing and press enter to search",type:"text",value:l,onChange:e=>{r(e.target.value)},onKeyDown:async e=>{if(13==e.keyCode){a(null),s({DATA:[]}),i(!0);try{let e=await g(`endpoint_search?filter_fulltext=${l}`);s(e),i(!1),p.push("/endpoints")}catch(e){i(!1),a(e)}}}})))),d().createElement(m.Route,{exact:!0,path:"/endpoints",render:e=>d().createElement(N,Object.assign({},e,{endpoints:n,handleEndpointClick:f}))}),d().createElement(m.Route,{exact:!0,path:"/endpoints/:endpointID"},d().createElement(w,Object.assign({},e,{selectedJupyterItems:e.selectedJupyterItems,handleShowSearch:b}))),d().createElement(m.Route,{path:"/endpoints/:endpointID/items/:path"},d().createElement(w,Object.assign({},e,{selectedJupyterItems:e.selectedJupyterItems,handleShowSearch:b}))))};a(1802),a(4039),a(5511);const k=e=>{const[t,a]=(0,u.useState)(),n=(0,p.useSetRecoilState)(f);(0,u.useEffect)((()=>{n(e.config)}),[e.config]),(0,u.useEffect)((()=>{s()}),[e.jupyterItems]);const s=async()=>{let t=[],n=[],s={};for(let a of e.jupyterItems)try{let s=await fetch(i(`api/contents/${a.path}`),{headers:{Accept:"application/json",Authorization:`token ${e.jupyterToken}`,"Content-Type":"application/json"}}),l=await s.json();"directory"==l.type?t.push(l):n.push(l)}catch(e){console.log(e)}s.directories=t,s.files=n,n.length&&t.length||n.length&&!t.length?s.transferDirection="toEndpoint":s.transferDirection="toFromEndpoint",a(s)};return d().createElement("div",{className:"container pt-5"},d().createElement("div",{className:"row"},d().createElement("div",{className:"col-8"},d().createElement("a",{href:"#",onClick:async e=>{e.preventDefault(),await g("logout"),window.open("https://app.globus.org/logout","Logout of Globus","height=600,width=800").focus(),window.location.reload()}},d().createElement("i",{className:"fa-solid fa-arrow-right-from-bracket"})," Logout of Globus"),d().createElement("hr",{className:"mb-3 mt-3"}))),d().createElement(_,{factory:e.factory,selectedJupyterItems:t}))};class S extends n.ReactWidget{constructor(e={},t=null,a="",n=[]){super(),this.config=e,this.factory=t,this.jupyterItems=n,this.jupyterToken=a,this.addClass("jp-ReactWidget")}render(){return d().createElement(m.HashRouter,null,d().createElement(p.RecoilRoot,null,d().createElement(m.Switch,null,d().createElement(m.Route,{path:"/",render:e=>d().createElement(k,Object.assign({},e,{config:this.config,factory:this.factory,jupyterItems:this.jupyterItems,jupyterToken:this.jupyterToken}))}))))}}a(7549);const x={id:"@jupyterlab/globus_jupyterlab",autoStart:!0,requires:[s.IFileBrowserFactory],activate:async function(e,t){console.log("Globus Jupyterlab Extension Activated!");try{const a=await g("config");console.log("Fetching basic data about the notebook server environment:",a);let s=[{command:"globus-jupyterlab-transfer/context-menu:open",label:"Initiate Globus Transfer",caption:"Login with Globus to Initiate Transfers",execute:async()=>{var a=t.tracker.currentWidget.selectedItems(),s=l.PageConfig.getToken();let r=[],o=!0;for(;o;){let e=a.next();e?r.push(e):o=!1}const i=await g("config"),m=new S(i,t,s,r),u=new n.MainAreaWidget({content:m});if(u.title.label="Globus Jupyterlab Transfer",u.title.icon=c,i.is_logged_in)e.shell.add(u,"main");else{if(i.is_hub){const t=new y({config:i}),a=new n.MainAreaWidget({content:t});a.title.label="Authorization Code",a.title.icon=c,e.shell.add(a,"main")}else window.open(h("globus-jupyterlab/login"),"Globus Login","height=600,width=800").focus();let t=window.setInterval((async()=>{(await g("config")).is_logged_in&&(e.shell.add(u,"main"),clearInterval(t))}),1e3)}}}];((e,t)=>{for(let a of t)e.commands.addCommand(a.command,{label:a.label,caption:a.caption,icon:c,execute:a.execute})})(e,s)}catch(e){console.error(`Error activating Globus plugin.\n${e}`)}}},C=x}}]);