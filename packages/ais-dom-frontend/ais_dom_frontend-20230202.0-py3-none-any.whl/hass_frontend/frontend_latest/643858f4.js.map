{"version":3,"file":"643858f4.js","mappings":";AA+EA;AAeA;;;ACUA;;;AAGA;;AAKA;;AAGA;;AAIA;AACA;;AAEA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;AAIA;AACA;;AAEA;;;;AAOA","sources":["webpack://home-assistant-frontend/./src/components/ha-selector/ha-selector.ts","webpack://home-assistant-frontend/./src/panels/config/users/dialog-admin-change-password.ts"],"sourcesContent":["import { html, LitElement, PropertyValues } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport { dynamicElement } from \"../../common/dom/dynamic-element-directive\";\nimport type { Selector } from \"../../data/selector\";\nimport type { HomeAssistant } from \"../../types\";\n\nconst LOAD_ELEMENTS = {\n  action: () => import(\"./ha-selector-action\"),\n  addon: () => import(\"./ha-selector-addon\"),\n  area: () => import(\"./ha-selector-area\"),\n  attribute: () => import(\"./ha-selector-attribute\"),\n  boolean: () => import(\"./ha-selector-boolean\"),\n  color_rgb: () => import(\"./ha-selector-color-rgb\"),\n  config_entry: () => import(\"./ha-selector-config-entry\"),\n  date: () => import(\"./ha-selector-date\"),\n  datetime: () => import(\"./ha-selector-datetime\"),\n  device: () => import(\"./ha-selector-device\"),\n  duration: () => import(\"./ha-selector-duration\"),\n  entity: () => import(\"./ha-selector-entity\"),\n  statistic: () => import(\"./ha-selector-statistic\"),\n  file: () => import(\"./ha-selector-file\"),\n  navigation: () => import(\"./ha-selector-navigation\"),\n  number: () => import(\"./ha-selector-number\"),\n  object: () => import(\"./ha-selector-object\"),\n  select: () => import(\"./ha-selector-select\"),\n  state: () => import(\"./ha-selector-state\"),\n  target: () => import(\"./ha-selector-target\"),\n  template: () => import(\"./ha-selector-template\"),\n  text: () => import(\"./ha-selector-text\"),\n  time: () => import(\"./ha-selector-time\"),\n  icon: () => import(\"./ha-selector-icon\"),\n  media: () => import(\"./ha-selector-media\"),\n  theme: () => import(\"./ha-selector-theme\"),\n  location: () => import(\"./ha-selector-location\"),\n  color_temp: () => import(\"./ha-selector-color-temp\"),\n  \"ui-action\": () => import(\"./ha-selector-ui-action\"),\n  \"ui-color\": () => import(\"./ha-selector-ui-color\"),\n};\n\n@customElement(\"ha-selector\")\nexport class HaSelector extends LitElement {\n  @property() public hass!: HomeAssistant;\n\n  @property() public name?: string;\n\n  @property() public selector!: Selector;\n\n  @property() public value?: any;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property() public localizeValue?: (key: string) => string;\n\n  @property() public placeholder?: any;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = true;\n\n  @property() public context?: Record<string, any>;\n\n  public focus() {\n    this.shadowRoot?.getElementById(\"selector\")?.focus();\n  }\n\n  private get _type() {\n    return Object.keys(this.selector)[0];\n  }\n\n  protected willUpdate(changedProps: PropertyValues) {\n    if (changedProps.has(\"selector\") && this.selector) {\n      LOAD_ELEMENTS[this._type]?.();\n    }\n  }\n\n  protected render() {\n    return html`\n      ${dynamicElement(`ha-selector-${this._type}`, {\n        hass: this.hass,\n        name: this.name,\n        selector: this.selector,\n        value: this.value,\n        label: this.label,\n        placeholder: this.placeholder,\n        disabled: this.disabled,\n        required: this.required,\n        helper: this.helper,\n        context: this.context,\n        localizeValue: this.localizeValue,\n        id: \"selector\",\n      })}\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector\": HaSelector;\n  }\n}\n","import \"@material/mwc-button\";\nimport { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\n\nimport { fireEvent } from \"../../../common/dom/fire_event\";\nimport { createCloseHeading } from \"../../../components/ha-dialog\";\nimport \"../../../components/ha-form/ha-form\";\nimport { SchemaUnion } from \"../../../components/ha-form/types\";\nimport \"../../../components/ha-textfield\";\nimport { adminChangePassword } from \"../../../data/auth\";\nimport { haStyleDialog } from \"../../../resources/styles\";\nimport { HomeAssistant } from \"../../../types\";\nimport { showToast } from \"../../../util/toast\";\nimport { AdminChangePasswordDialogParams } from \"./show-dialog-admin-change-password\";\n\nconst SCHEMA = [\n  {\n    name: \"new_password\",\n    required: true,\n    selector: {\n      text: {\n        type: \"password\",\n        autocomplete: \"new-password\",\n      },\n    },\n  },\n  {\n    name: \"password_confirm\",\n    required: true,\n    selector: {\n      text: {\n        type: \"password\",\n        autocomplete: \"new-password\",\n      },\n    },\n  },\n] as const;\n\ntype FormData = { new_password?: string; password_confirm?: string };\n\n@customElement(\"dialog-admin-change-password\")\nclass DialogAdminChangePassword extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @state() private _params?: AdminChangePasswordDialogParams;\n\n  @state() private _userId?: string;\n\n  @state() private _data?: FormData;\n\n  @state() private _error?: Record<string, string>;\n\n  @state() private _submitting = false;\n\n  @state() private _success = false;\n\n  public showDialog(params: AdminChangePasswordDialogParams): void {\n    this._params = params;\n    this._userId = params.userId;\n  }\n\n  public closeDialog(): void {\n    this._params = undefined;\n    this._data = undefined;\n    this._submitting = false;\n    this._success = false;\n    fireEvent(this, \"dialog-closed\", { dialog: this.localName });\n  }\n\n  private _computeLabel = (schema: SchemaUnion<typeof SCHEMA>) =>\n    this.hass.localize(`ui.panel.config.users.change_password.${schema.name}`);\n\n  private _computeError = (error: string) =>\n    this.hass.localize(\n      `ui.panel.config.users.change_password.${error}` as any\n    ) || error;\n\n  private _validate() {\n    if (\n      this._data &&\n      this._data.new_password &&\n      this._data.password_confirm &&\n      this._data.new_password !== this._data.password_confirm\n    ) {\n      this._error = {\n        password_confirm: \"password_no_match\",\n      };\n    } else {\n      this._error = undefined;\n    }\n  }\n\n  protected render(): TemplateResult {\n    if (!this._params) {\n      return html``;\n    }\n\n    const canSubmit = Boolean(\n      this._data?.new_password && this._data?.password_confirm && !this._error\n    );\n\n    return html`\n      <ha-dialog\n        open\n        @closed=${this.closeDialog}\n        scrimClickAction\n        escapeKeyAction\n        .heading=${createCloseHeading(\n          this.hass,\n          this.hass.localize(\"ui.panel.config.users.change_password.caption\")\n        )}\n      >\n        ${this._success\n          ? html`\n              <p>\n                ${this.hass.localize(\n                  \"ui.panel.config.users.change_password.password_changed\"\n                )}\n              </p>\n              <mwc-button slot=\"primaryAction\" @click=${this.closeDialog}>\n                ${this.hass.localize(\"ui.dialogs.generic.ok\")}\n              </mwc-button>\n            `\n          : html`\n              <ha-form\n                .hass=${this.hass}\n                .data=${this._data}\n                .error=${this._error}\n                .schema=${SCHEMA}\n                .computeLabel=${this._computeLabel}\n                .computeError=${this._computeError}\n                @value-changed=${this._valueChanged}\n                .disabled=${this._submitting}\n              ></ha-form>\n              <mwc-button slot=\"primaryAction\" @click=${this.closeDialog}>\n                ${this.hass.localize(\"ui.common.cancel\")}\n              </mwc-button>\n              <mwc-button\n                slot=\"primaryAction\"\n                @click=${this._changePassword}\n                .disabled=${this._submitting || !canSubmit}\n              >\n                ${this.hass.localize(\n                  \"ui.panel.config.users.change_password.change\"\n                )}\n              </mwc-button>\n            `}\n      </ha-dialog>\n    `;\n  }\n\n  private _valueChanged(ev) {\n    this._data = ev.detail.value;\n    this._validate();\n  }\n\n  private async _changePassword(): Promise<void> {\n    if (!this._userId || !this._data?.new_password) return;\n    try {\n      this._submitting = true;\n      await adminChangePassword(\n        this.hass,\n        this._userId!,\n        this._data.new_password\n      );\n      this._success = true;\n    } catch (err: any) {\n      showToast(this, {\n        message: err.body?.message || err.message || err,\n      });\n    } finally {\n      this._submitting = false;\n    }\n  }\n\n  static get styles(): CSSResultGroup {\n    return [haStyleDialog, css``];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"dialog-admin-change-password\": DialogAdminChangePassword;\n  }\n}\n"],"names":[],"sourceRoot":""}