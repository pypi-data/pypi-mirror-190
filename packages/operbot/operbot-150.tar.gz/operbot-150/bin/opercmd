#!/usr/bin/env python3
# This file is placed in the Public Domain.


"operator bot command"


import os
import readline
import sys
import termios
import time
import traceback


from operbot import Command, Default, Handler, Parsed, Storage
from operbot import launch, privileges, scan, update, wait


from operbot.modules import cmd, fnd, irc, log, rss


Cfg = Default()
Storage.workdir = "/var/lib/operbot/"


scan(cmd)
scan(fnd)
scan(irc)
scan(log)
scan(rss)


class CLI(Handler):

    def __init__(self):
        Handler.__init__(self)
        self.register("command", self.dispatch)

    def announce(self, txt):
        pass

    def raw(self, txt):
        print(txt)
        sys.stdout.flush()


def main():
    #privileges("operbot")
    p = Parsed()
    p.parse(" ".join(sys.argv[1:]))
    update(Cfg, p)
    e = Command()
    e.type = "command"
    e.txt = Cfg.otxt
    e.parse(e.txt)
    cli = CLI()
    cli.handle(e)
    e.wait()


main()
